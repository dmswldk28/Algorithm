## 발신자별 통화 간격 평균

### 문제 설명
- `CALL_EVENTS` 테이블이 주어짐.  
- 컬럼:
  - `CALL_ID` : 통화 이벤트 ID  
  - `CALLER` : 발신자 번호  
  - `START` : 통화 시작 시각  
  - `END` : 통화 종료 시각  

- 목표: 발신자별로
  1. 통화 횟수 (`CNT`)  
  2. 평균 **전화 간격** (`AVERAGE`, 초 단위)  
     - 전화 간격 = 이전 통화 종료(`END`) 후 다음 통화 시작(`START`)까지 시간  

- 정렬 기준: 필요시 발신자 기준 ASC  

---

### 테이블 예시

**CALL_EVENTS 테이블**

| CALL_ID | CALLER          | START               | END                 |
|---------|-----------------|-------------------|-------------------|
| 1       | 010-1111-2222  | 2025-08-13 13:34:23 | 2025-08-13 13:37:00 |
| 2       | 010-3333-4444  | 2025-08-13 13:38:23 | 2025-08-13 13:40:04 |
| 3       | 010-5555-6666  | 2025-08-14 17:00:23 | 2025-08-14 18:00:00 |
| 4       | 010-1111-2222  | 2025-08-14 17:56:56 | 2025-08-14 18:13:13 |
| 5       | 010-5555-6666  | 2025-08-15 09:09:09 | 2025-08-15 09:12:12 |
| 6       | 010-7777-8888  | 2025-08-15 11:11:11 | 2025-08-15 11:11:11 |
| 7       | 010-1111-2222  | 2025-08-16 21:21:21 | 2025-08-16 21:23:23 |
| 8       | 010-3333-4444  | 2025-08-16 23:23:23 | 2025-08-16 23:24:25 |

### 입출력 예시 (CNT 기준 내림차순)

| CALLER          | CNT | AVERAGE       |
|-----------------|-----|---------------|
| 010-1111-2222  | 2   | 159416.5      |
| 010-3333-4444  | 1   | 0             |
| 010-5555-6666  | 1   | 0             |
| 010-7777-8888  | 0   | NULL          |

> CNT가 많은 순으로 정렬, 같은 CNT는 CALLER 기준 오름차순

---

### SQL 풀이 아이디어
1. 발신자별로 통화 시작 시각(`START`) 기준 정렬  
2. `LAG(END)` 함수를 이용해 이전 통화 종료 시각 가져오기  
3. 현재 통화 시작 시각 - 이전 통화 종료 시각 → **전화 간격** 계산  
4. 발신자별 평균 전화 간격과 통화 횟수 집계  

---

### SQL 예시 코드 (MySQL 기준)
```sql
WITH call_with_lag AS (
    SELECT
        CALLER,
        START,
        END,
        LAG(END) OVER (PARTITION BY CALLER ORDER BY START) AS prev_end
    FROM CALL_EVENTS
)
SELECT
    CALLER,
    COUNT(*) AS CNT,
    ROUND(AVG(TIMESTAMPDIFF(SECOND, prev_end, START)), 2) AS AVERAGE
FROM call_with_lag
WHERE prev_end IS NOT NULL
GROUP BY CALLER
ORDER BY CNT DESC, CALLER ASC;
````

> 주의: 첫 번째 통화는 이전 통화가 없으므로 `prev_end IS NOT NULL` 필터링

